<!-- Header del producto -->
<div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-lg p-6 mb-6">
  <h1 class="text-3xl font-bold text-primary mb-2">{{ product()?.title || 'Nuevo Producto' }}</h1>
  <p class="text-base-content/70">Edita los detalles del producto</p>
</div>

<form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
  <!-- Datos generales -->
  <div class="space-y-6">
    <!-- Información básica -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title text-xl mb-4 flex items-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Información Básica
        </h2>

        <div class="form-control">
          <label class="label" for="product-title">
            <span class="label-text font-medium">Título del Producto</span>
          </label>
          <input id="product-title" type="text" placeholder="Ingresa el título del producto"
            class="input input-bordered w-full focus:input-primary" formControlName="title" />
          @if (productForm.get('title')?.errors?.['required']) {
          <span class="text-sm text-red-500">El título es requerido</span>
          }
        </div>

        <div class="form-control">
          <label class="label" for="product-slug">
            <span class="label-text font-medium">Slug</span>
          </label>
          <input id="product-slug" type="text" placeholder="url-del-producto" z
            class="input input-bordered w-full focus:input-primary" formControlName="slug" />
          @if (productForm.get('slug')?.errors?.['required']) {
          <span class="text-sm text-red-500">El slug es requerido</span>
          }
          @if (productForm.get('slug')?.errors?.['pattern']) {
          <span class="text-sm text-red-500">El slug no es válido</span>
          }
        </div>

        <div class="form-control">
          <label class="label" for="product-description">
            <span class="label-text font-medium">Descripción</span>
          </label>
          <textarea id="product-description" class="textarea textarea-bordered focus:textarea-primary"
            placeholder="Describe el producto..." rows="4" formControlName="description"></textarea>
        </div>
        @if (productForm.get('description')?.errors?.['required']) {
        <span class="text-sm text-red-500">La descripción es requerida</span>
        }
      </div>
    </div>

    <!-- Datos de venta -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title text-xl mb-4 flex items-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1">
            </path>
          </svg>
          Datos de Venta
        </h2>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="form-control">
            <label class="label" for="product-price">
              <span class="label-text font-medium">Precio</span>
            </label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-base-content/60">$</span>
              <input id="product-price" type="number" placeholder="0.00"
                class="input input-bordered w-full pl-8 focus:input-primary" formControlName="price" />
              @if (productForm.get('price')?.errors?.['required']) {
              <span class="text-sm text-red-500">El precio es requerido</span>
              }
              @if (productForm.get('price')?.errors?.['min']) {
              <span class="text-sm text-red-500">El precio debe ser mayor a 0</span>
              }
            </div>
          </div>

          <div class="form-control">
            <label class="label" for="product-inventory">
              <span class="label-text font-medium">Inventario</span>
            </label>
            <input id="product-inventory" type="number" placeholder="0"
              class="input input-bordered w-full focus:input-primary" formControlName="stock" />
            @if (productForm.get('stock')?.errors?.['required']) {
            <span class="text-sm text-red-500">El inventario es requerido</span>
            }
            @if (productForm.get('stock')?.errors?.['min']) {
            <span class="text-sm text-red-500">El inventario debe ser mayor a 0</span>
            }
          </div>
        </div>

        <div class="form-control">
          <label class="label" for="product-tags">
            <span class="label-text font-medium">Tags</span>
          </label>
          <input id="product-tags" type="text" placeholder="tag1, tag2, tag3"
            class="input input-bordered w-full focus:input-primary" formControlName="tags" />
          @if (productForm.get('tags')?.errors?.['required']) {
          <span class="text-sm text-red-500">Los tags son requeridos</span>
          }
        </div>
      </div>
    </div>

    <!-- Género -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title text-xl mb-4 flex items-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          Género
        </h2>

        <div class="grid grid-cols-3 gap-3">
          <button type="button" class="btn  btn-outline btn-sm hover:btn-primary"
            [class.btn-primary]="productForm.value.gender === 'men'"
            (click)="productForm.patchValue({ gender: 'men' })">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd">
              </path>
            </svg>
            Masculino
          </button>
          <button type="button" class="btn btn-outline btn-sm hover:btn-accent"
            [class.btn-accent]="productForm.value.gender === 'women'"
            (click)="productForm.patchValue({ gender: 'women' })">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd">
              </path>
            </svg>
            Femenino
          </button>
          <button type="button" class="btn btn-outline btn-sm hover:btn-secondary"
            [class.btn-secondary]="productForm.value.gender === 'kid'"
            (click)="productForm.patchValue({ gender: 'kid' })">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd">
              </path>
            </svg>
            Niñ@
          </button>
          <button type="button" class="btn btn-outline btn-sm hover:btn-info"
            [class.btn-info]="productForm.value.gender === 'unisex'"
            (click)="productForm.patchValue({ gender: 'unisex' })">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd">
              </path>
            </svg>
            Unisex
          </button>
        </div>
      </div>
    </div>

    <!-- Tallas -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title text-xl mb-4 flex items-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z">
            </path>
          </svg>
          Tallas Disponibles
        </h2>

        <div class="grid grid-cols-6 gap-2">
          @for (size of sizes; track size) {
          <button type="button" class="btn btn-sm btn-outline"
            [class.btn-primary]="productForm.value.sizes?.includes(size)" (click)="onSizeClick(size)">{{ size
            }}</button>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Panel de imágenes -->
  <div class="space-y-6">
    <!-- Botón de guardar -->
    <div class="flex justify-end">
      <button type="submit" class="btn btn-primary btn-lg shadow-lg hover:shadow-xl transition-all">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        Guardar Cambios
      </button>
    </div>

    <!-- Galería de imágenes -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title text-xl mb-4 flex items-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
            </path>
          </svg>
          Imágenes del Producto
        </h2>

        <!-- Imagen principal -->
        <div class="relative group">
          <div class="aspect-square bg-gradient-to-br from-base-200 to-base-300 rounded-xl overflow-hidden shadow-lg">
            <img [src]="product()?.images | appImageProduct: idImage()" [alt]="product()?.title"
              class="w-full h-full object-cover transition-transform group-hover:scale-105" />
          </div>

          <!-- Overlay con información -->
          <div class="absolute top-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm font-medium">
            Imagen {{ idImage() + 1 }}
          </div>
        </div>

        <!-- Galería de miniaturas -->
        @if (product()?.images && product()?.images!.length > 1) {
        <div class="grid grid-cols-4 gap-2">
          @for (image of product()?.images; track $index) {
          <div
            class="aspect-square bg-base-200 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity"
            (click)="changeIdImage($index)">
            <img [src]="image | appImageProduct: $index" [alt]="product()?.title + ' - ' + ($index + 1)"
              class="w-full h-full object-cover" />
          </div>
          }
        </div>
        }@else {
        <div class="text-center text-base-content/60">No hay imágenes disponibles</div>
        }

        <!-- Subida de archivos -->
        <div class="mt-6">
          <h3 class="text-lg font-semibold mb-3">Agregar nuevas imágenes</h3>
          <div class="file-input-wrapper">
            <input type="file" multiple accept="image/*"
              class="file-input file-input-bordered w-full file-input-primary" (change)="onFileSelected($event)" />
            <div class="mt-2 text-sm text-base-content/60">
              <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              Arrastra archivos aquí o haz clic para seleccionar
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
@if (isSaved()) {
<div class="alert alert-info fixed bottom-4 right-4 w-80 animate-in fade-in-0 duration-300">
  <span>Se ha guardado correctamente el producto</span>
</div>
}
